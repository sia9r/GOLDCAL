<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <base href="/GOLDCAL/">
    <title>محاسبه قیمت طلا</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        body {
            font-family: 'Vazirmatn', Tahoma, sans-serif;
            background: linear-gradient(145deg, #f9f1e7, #ffe5b4);
            padding: 40px;
            text-align: center;
            color: #333;
            font-weight: 700;
        }
        .box {
            background: #fff8e1;
            padding: 40px;
            border-radius: 25px;
            max-width: 800px;
            margin: auto;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .box:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.3);
        }
        h2 {
            font-size: 36px;
            margin-bottom: 25px;
            color: #b8860b;
            font-weight: 900;
        }
        label {
            font-size: 24px;
            font-weight: 800;
        }
        input,
        button {
            padding: 18px;
            font-size: 24px;
            width: 100%;
            margin: 12px 0;
            border-radius: 14px;
            border: 2px solid #d4af37;
            text-align: center;
            font-weight: 700;
        }
        input {
            background: #fffbe6;
        }
        .calc {
            background: linear-gradient(45deg, #f9d976, #f39c12);
            color: white;
            cursor: pointer;
            transition: 0.3s, transform 0.2s;
        }
        .calc:hover {
            background: linear-gradient(45deg, #f7c948, #e07b00);
            transform: scale(1.05);
        }
        .result {
            margin-top: 30px;
            padding: 35px;
            background: #fff3e0;
            border-radius: 18px;
            font-size: 26px;
            line-height: 1.8;
            min-height: 80px;
            border: 2px solid #f0c27b;
            font-weight: 700;
            transition: transform 0.3s;
        }
        .round-buttons {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
        }
        .round-buttons button {
            width: 110px;
            font-size: 18px;
            padding: 12px;
            border-radius: 14px;
            border: 2px solid #d4af37;
            background: #fffbe6;
            cursor: pointer;
            transition: 0.3s, transform 0.2s;
            font-weight: 700;
            color: #b8860b;
        }
        .round-buttons button.selected {
            background: #d4af37;
            color: white;
            border-color: #b8860b;
            transform: scale(1.05);
        }
        .round-buttons button:hover:not(.selected) {
            background: #f9e4b7;
        }
        .round-price {
            display: inline-block;
            transition: transform 0.4s, opacity 0.4s, text-shadow 0.4s;
            color: #b8860b;
            font-weight: 900;
            font-size: 28px;
        }
        .animate {
            transform: translateY(-15px);
            opacity: 0;
            text-shadow: 0 0 15px #ffd700, 0 0 25px #ffd700, 0 0 35px #ffd700;
        }
        @media(max-width: 600px) {
            input,
            button {
                font-size: 20px;
                padding: 14px;
            }
            .result {
                font-size: 22px;
                padding: 25px;
            }
            h2 {
                font-size: 28px;
            }
            .round-buttons button {
                width: 90px;
                font-size: 16px;
            }
            .round-price {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="box">
        <h2>محاسبه قیمت هر گرم طلای ۱۸ عیار</h2>
        <label>قیمت نهایی را وارد کنید:</label>
        <input type="text" id="T" placeholder="مثال: 10,000,000" oninput="formatAndCalc(this)">
        <div class="round-buttons" id="roundButtons"></div>
        <button class="calc" onclick="calculate()">محاسبه دستی</button>
        <div class="result" id="result">⌨️</div>
    </div>
    <script>
        const roundOptions = [5000, 10000, 15000, 20000, 25000, 30000, 35000, 40000, 45000, 50000];
        let selectedRound = 50000;
        const container = document.getElementById("roundButtons");
        roundOptions.forEach(val => {
            const btn = document.createElement("button");
            btn.innerText = val.toLocaleString();
            if (val === selectedRound) btn.classList.add("selected");
            btn.onclick = () => {
                selectedRound = val;
                document.querySelectorAll(".round-buttons button").forEach(b => b.classList.remove("selected"));
                btn.classList.add("selected");
                calculate();
            };
            container.appendChild(btn);
        });
        
        function formatAndCalc(input) {
            let value = input.value.replace(/,/g, "");
            if (!isNaN(value) && value.length > 0) {
                input.value = Number(value).toLocaleString("en-US");
            }
            calculate();
        }
        function roundUpToSelected(value) {
            return Math.ceil(value / selectedRound) * selectedRound;
        }
        function animatePriceChange(element, newValue) {
            element.classList.add('animate');
            setTimeout(() => {
                element.innerHTML = newValue.toLocaleString() + " تومان";
                element.classList.remove('animate');
            }, 200);
        }
        function calculate() {
            let rawValue = document.getElementById("T").value.replace(/,/g, "");
            let T = parseFloat(rawValue);
            if (isNaN(T) || T <= 0) {
                document.getElementById("result").innerHTML = "❌ لطفا عدد معتبر وارد کنید.";
                return;
            }
            let weight = 1.0;
            let wage = 10000;
            let tolerance = 0.005;
            let found = false;
            let answer = "";
            let finalPrice = 0;
            for (let pricePerGram = 50000; pricePerGram <= 200000000; pricePerGram += 500) {
                let goldCost = weight * pricePerGram;
                let wageCost = weight * wage;
                let profit = 0.07 * (goldCost + wageCost);
                let tax = 0.10 * (wageCost + profit);
                finalPrice = goldCost + wageCost + profit + tax;
                let error = (finalPrice - T) / T * 100;
                if (error >= 0 && error <= tolerance * 100) {
                    let roundedPrice = roundUpToSelected(finalPrice);
                    answer = `✅ :<br>
                       
                        قیمت هر گرم طلای ۱۸: <b>${pricePerGram.toLocaleString()}</b> تومان<br>
                        خطا: ${error.toFixed(3)}٪`;
                    found = true;
                    break;
                }
            }
            if (!found) {
                answer = "❌ در تلورانس مشخص شده، قیمتی پیدا نشد.";
            }
            document.getElementById("result").innerHTML = answer;
            const roundSpan = document.querySelector(".round-price");
            if (roundSpan) {
                animatePriceChange(roundSpan, roundUpToSelected(finalPrice));
            }
        }
    </script>
</body>
</html>
